=== Starting real-data smoke test (XGBoost + EBM) ===
Smoke root: /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs
Using raw data from: /home/exouser/js2-volume/projects/aki_prediction_project/data/raw
--- Step 01: Cohort construction ---
Total cases in VitalDB: 6388
All department cases: 6388
Cases after removing missing essential data: 6016

Initial Cohort DataFrame Head:
   caseid  subjectid  casestart  ...  intraop_phe  intraop_epi  intraop_ca
0       1       5955          0  ...            0            0           0
1       2       2487          0  ...            0            0           0
2       3       2861          0  ...            0            0           0
3       4       1903          0  ...            0            0           0
4       5       4416          0  ...          900            0        2100

[5 rows x 74 columns]
Missing value percentages for preoperative variables (>0%):
cline2                 99.069149
aline2                 98.420878
lmasize                98.337766
preop_be               91.356383
preop_sao2             91.339761
preop_hco3             91.339761
preop_pao2             91.256649
preop_paco2            91.256649
preop_ph               91.123670
dltubesize             86.768617
iv2                    77.892287
cline1                 76.861702
aline1                 46.841755
intraop_uo             42.021277
intraop_ebl            37.333777
tubesize               21.725399
cormack                12.998670
airway                  6.399601
intraop_crystalloid     6.183511
preop_na                4.421543
preop_k                 4.388298
position                3.075133
preop_aptt              1.579122
preop_pt                1.363032
iv1                     1.146941
preop_gluc              0.631649
preop_plt               0.548537
preop_hb                0.349069
preop_ast               0.249335
preop_alt               0.216090
preop_alb               0.116356
preop_bun               0.099734
dtype: float64
Using vitaldb.find_cases() to find all cases with the '['SNUADC/PLETH', 'SNUADC/ECG_II', 'Primus/CO2', 'Primus/AWP']' waveforms...
Total cases in VitalDB with 'SNUADC/PLETH' or substitute 'None': 6157
Found 5802 cases with 'SNUADC/PLETH' out of 6016 cases left in your cohort.
Waveform Availability in Cohort: 96.44%
Total cases in VitalDB with 'SNUADC/ECG_II' or substitute '['SNUADC/ECG_V5']': 6355
Found 5801 cases with 'SNUADC/ECG_II' out of 6016 cases left in your cohort.
Waveform Availability in Cohort: 96.43%
Total cases in VitalDB with 'Primus/CO2' or substitute 'None': 6362
Found 5778 cases with 'Primus/CO2' out of 6016 cases left in your cohort.
Waveform Availability in Cohort: 96.04%
Total cases in VitalDB with 'Primus/AWP' or substitute 'None': 6360
Found 5776 cases with 'Primus/AWP' out of 6016 cases left in your cohort.
Waveform Availability in Cohort: 96.01%

Your final cohort with available waveform data now has 5776 cases.
Cases after excluding severe kidney disease: 5584
Cohort size after ensuring sample independence: 5343

Filtering cohort to include only patients with postoperative creatinine labs...
Final study cohort size after excluding patients without post-op labs: 3462
Loading lab data...
Lab data loaded and filtered for creatinine.
Calculating AKI Stages:   0%|          | 0/3462 [00:00<?, ?it/s]Calculating AKI Stages:   3%|▎         | 98/3462 [00:00<00:03, 977.41it/s]Calculating AKI Stages:   6%|▌         | 204/3462 [00:00<00:03, 1024.24it/s]Calculating AKI Stages:   9%|▉         | 311/3462 [00:00<00:03, 1044.22it/s]Calculating AKI Stages:  12%|█▏        | 420/3462 [00:00<00:02, 1061.22it/s]Calculating AKI Stages:  15%|█▌        | 529/3462 [00:00<00:02, 1068.44it/s]Calculating AKI Stages:  18%|█▊        | 640/3462 [00:00<00:02, 1081.09it/s]Calculating AKI Stages:  22%|██▏       | 749/3462 [00:00<00:02, 1078.21it/s]Calculating AKI Stages:  25%|██▍       | 857/3462 [00:00<00:02, 1073.50it/s]Calculating AKI Stages:  28%|██▊       | 965/3462 [00:00<00:02, 1072.94it/s]Calculating AKI Stages:  31%|███       | 1073/3462 [00:01<00:02, 1073.89it/s]Calculating AKI Stages:  34%|███▍      | 1181/3462 [00:01<00:02, 1074.74it/s]Calculating AKI Stages:  37%|███▋      | 1291/3462 [00:01<00:02, 1079.84it/s]Calculating AKI Stages:  40%|████      | 1400/3462 [00:01<00:01, 1080.15it/s]Calculating AKI Stages:  44%|████▎     | 1509/3462 [00:01<00:01, 1078.10it/s]Calculating AKI Stages:  47%|████▋     | 1617/3462 [00:01<00:01, 1076.97it/s]Calculating AKI Stages:  50%|████▉     | 1725/3462 [00:01<00:01, 1075.65it/s]Calculating AKI Stages:  53%|█████▎    | 1833/3462 [00:01<00:01, 1075.97it/s]Calculating AKI Stages:  56%|█████▌    | 1941/3462 [00:01<00:01, 1071.71it/s]Calculating AKI Stages:  59%|█████▉    | 2050/3462 [00:01<00:01, 1074.65it/s]Calculating AKI Stages:  62%|██████▏   | 2158/3462 [00:02<00:01, 1074.60it/s]Calculating AKI Stages:  65%|██████▌   | 2267/3462 [00:02<00:01, 1076.54it/s]Calculating AKI Stages:  69%|██████▊   | 2375/3462 [00:02<00:01, 1075.42it/s]Calculating AKI Stages:  72%|███████▏  | 2483/3462 [00:02<00:00, 1074.20it/s]Calculating AKI Stages:  75%|███████▍  | 2591/3462 [00:02<00:00, 1071.86it/s]Calculating AKI Stages:  78%|███████▊  | 2699/3462 [00:02<00:00, 1072.36it/s]Calculating AKI Stages:  81%|████████  | 2807/3462 [00:02<00:00, 1074.42it/s]Calculating AKI Stages:  84%|████████▍ | 2915/3462 [00:02<00:00, 1071.51it/s]Calculating AKI Stages:  87%|████████▋ | 3023/3462 [00:02<00:00, 1073.06it/s]Calculating AKI Stages:  90%|█████████ | 3131/3462 [00:02<00:00, 1071.93it/s]Calculating AKI Stages:  94%|█████████▎| 3240/3462 [00:03<00:00, 1076.65it/s]Calculating AKI Stages:  97%|█████████▋| 3348/3462 [00:03<00:00, 1076.65it/s]Calculating AKI Stages: 100%|█████████▉| 3457/3462 [00:03<00:00, 1079.63it/s]Calculating AKI Stages: 100%|██████████| 3462/3462 [00:03<00:00, 1071.48it/s]

AKI Labeling Complete.
Distribution of AKI Stages:
aki_stage
0    3290
1     128
2      23
3      21
Name: count, dtype: int64

Distribution of AKI Binary (Stage >= 1):
aki_label
0    3290
1     172
Name: count, dtype: int64

Distribution of Severe AKI (Stage >= 2):
y_severe_aki
0    3418
1      44
Name: count, dtype: Int64

Your final cohort after all custom filters has 3462 cases.
      caseid  subjectid  casestart  ...  aki_stage  aki_label  y_severe_aki
3593    3594          1          0  ...          0          0             0
6197    6198          3          0  ...          0          0             0
3416    3417          4          0  ...          0          0             0
733      734          5          0  ...          0          0             0
1579    1580          6          0  ...          0          0             0

[5 rows x 77 columns]

--- Deriving Additional Outcomes ---
Mapping 'icu_days' to 'los_icu'...
Calculating 'los_postop' from 'dis' and 'opend'...
In-hospital mortality (y_inhosp_mortality) counts:
y_inhosp_mortality
0    3435
1      27
Name: count, dtype: Int64
ICU admission (y_icu_admit) counts:
y_icu_admit
0    2669
1     793
Name: count, dtype: Int64
Prolonged LOS Threshold (75th percentile): 7.57 days
Prolonged LOS (y_prolonged_los_postop) counts:
y_prolonged_los_postop
0    2596
1     866
Name: count, dtype: Int64
Severe AKI (y_severe_aki) counts:
y_severe_aki
0    3418
1      44
Name: count, dtype: Int64

Final cohort saved to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_pleth_ecg_co2_awp.csv
--- Trimming cohort to 120 cases ---
Cohort trimmed to 120 rows at /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_pleth_ecg_co2_awp.csv (Pos: 60, Neg: 60)
--- Step 02: Catch22 feature extraction ---
2026-01-03 22:14:59,594 - INFO - Starting catch22 feature extraction...
2026-01-03 22:14:59,594 - INFO - Mode 'full': Output=/home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_pleth_ecg_co2_awp_inf.csv, Error=/home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_pleth_ecg_co2_awp_inf_errors.csv
2026-01-03 22:14:59,594 - INFO - Mode 'windowed': Output=/home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_pleth_ecg_co2_awp_inf_windowed.csv, Error=/home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_pleth_ecg_co2_awp_inf_errors_windowed.csv
2026-01-03 22:14:59,601 - INFO - Loaded 120 cases from /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_pleth_ecg_co2_awp.csv
2026-01-03 22:14:59,601 - INFO - Mode 'full': Found 0 previously processed pairs.
2026-01-03 22:14:59,601 - INFO - Mode 'windowed': Found 0 previously processed pairs.
2026-01-03 22:14:59,607 - INFO - 480 pairs to process.
2026-01-03 22:14:59,607 - INFO - Using 30 worker processes.
Extracting Features:   0%|          | 0/480 [00:00<?, ?it/s]Extracting Features:   0%|          | 1/480 [00:03<27:48,  3.48s/it]Extracting Features:   0%|          | 2/480 [00:03<13:02,  1.64s/it]Extracting Features:   1%|          | 3/480 [00:12<38:06,  4.79s/it]Extracting Features:   1%|          | 4/480 [00:12<24:20,  3.07s/it]Extracting Features:   1%|          | 5/480 [00:13<18:39,  2.36s/it]Extracting Features:   1%|▏         | 6/480 [00:14<13:35,  1.72s/it]Extracting Features:   1%|▏         | 7/480 [00:14<09:24,  1.19s/it]Extracting Features:   2%|▏         | 9/480 [00:14<05:05,  1.54it/s]Extracting Features:   2%|▏         | 10/480 [00:15<04:48,  1.63it/s]Extracting Features:   2%|▏         | 11/480 [00:18<11:11,  1.43s/it]Extracting Features:   2%|▎         | 12/480 [00:19<09:24,  1.21s/it]Extracting Features:   3%|▎         | 13/480 [00:19<06:58,  1.12it/s]Extracting Features:   3%|▎         | 15/480 [00:20<06:23,  1.21it/s]Extracting Features:   3%|▎         | 16/480 [00:22<06:49,  1.13it/s]Extracting Features:   4%|▎         | 17/480 [00:22<05:53,  1.31it/s]Extracting Features:   4%|▍         | 18/480 [00:22<05:12,  1.48it/s]Extracting Features:   4%|▍         | 19/480 [00:24<06:33,  1.17it/s]Extracting Features:   4%|▍         | 20/480 [00:24<05:17,  1.45it/s]Extracting Features:   5%|▍         | 22/480 [00:25<03:44,  2.04it/s]Extracting Features:   5%|▍         | 23/480 [00:26<05:31,  1.38it/s]Extracting Features:   5%|▌         | 24/480 [00:26<04:47,  1.59it/s]Extracting Features:   5%|▌         | 25/480 [00:27<04:11,  1.81it/s]Extracting Features:   5%|▌         | 26/480 [00:28<05:30,  1.38it/s]Extracting Features:   6%|▌         | 27/480 [00:28<05:06,  1.48it/s]Extracting Features:   6%|▌         | 28/480 [00:29<04:24,  1.71it/s]Extracting Features:   6%|▌         | 29/480 [00:32<09:39,  1.29s/it]Extracting Features:   6%|▋         | 30/480 [00:33<08:34,  1.14s/it]Extracting Features:   6%|▋         | 31/480 [00:33<06:49,  1.10it/s]Extracting Features:   7%|▋         | 33/480 [00:33<03:58,  1.87it/s]Extracting Features:   7%|▋         | 34/480 [00:34<05:07,  1.45it/s]Extracting Features:   8%|▊         | 36/480 [00:35<03:47,  1.95it/s]Extracting Features:   8%|▊         | 37/480 [00:37<06:28,  1.14it/s]Extracting Features:   8%|▊         | 38/480 [00:37<05:26,  1.35it/s]Extracting Features:   8%|▊         | 39/480 [00:37<04:12,  1.75it/s]Extracting Features:   8%|▊         | 40/480 [00:38<04:34,  1.60it/s]Extracting Features:   9%|▉         | 42/480 [00:39<03:28,  2.11it/s]Extracting Features:   9%|▉         | 43/480 [00:39<02:54,  2.50it/s]Extracting Features:   9%|▉         | 44/480 [00:40<05:08,  1.41it/s]Extracting Features:   9%|▉         | 45/480 [00:41<04:30,  1.61it/s]Extracting Features:  10%|▉         | 46/480 [00:41<04:23,  1.64it/s]Extracting Features:  10%|▉         | 47/480 [00:42<04:29,  1.61it/s]Extracting Features:  10%|█         | 50/480 [00:42<02:16,  3.15it/s]Extracting Features:  11%|█         | 51/480 [00:43<02:18,  3.10it/s]Extracting Features:  11%|█         | 52/480 [00:43<02:39,  2.69it/s]Extracting Features:  11%|█         | 53/480 [00:43<02:42,  2.63it/s]Extracting Features:  12%|█▏        | 57/480 [00:44<01:14,  5.65it/s]Extracting Features:  12%|█▏        | 59/480 [00:44<01:38,  4.29it/s]Extracting Features:  12%|█▎        | 60/480 [00:45<01:43,  4.05it/s]Extracting Features:  13%|█▎        | 61/480 [00:45<01:40,  4.17it/s]Extracting Features:  13%|█▎        | 63/480 [00:45<01:15,  5.51it/s]Extracting Features:  13%|█▎        | 64/480 [00:45<01:14,  5.57it/s]Extracting Features:  14%|█▎        | 65/480 [00:45<01:11,  5.79it/s]Extracting Features:  14%|█▍        | 66/480 [00:46<01:09,  5.93it/s]Extracting Features:  14%|█▍        | 67/480 [00:48<04:31,  1.52it/s]Extracting Features:  14%|█▍        | 69/480 [00:48<03:33,  1.93it/s]Extracting Features:  15%|█▍        | 71/480 [00:49<03:23,  2.01it/s]Extracting Features:  15%|█▌        | 72/480 [00:50<03:17,  2.07it/s]Extracting Features:  15%|█▌        | 74/480 [00:50<02:16,  2.98it/s]Extracting Features:  16%|█▌        | 76/480 [00:50<01:36,  4.18it/s]Extracting Features:  16%|█▌        | 77/480 [00:50<01:33,  4.32it/s]Extracting Features:  16%|█▋        | 79/480 [00:50<01:26,  4.65it/s]Extracting Features:  17%|█▋        | 81/480 [00:51<01:05,  6.09it/s]Extracting Features:  17%|█▋        | 82/480 [00:51<01:55,  3.46it/s]Extracting Features:  17%|█▋        | 83/480 [00:52<02:26,  2.71it/s]Extracting Features:  18%|█▊        | 84/480 [00:52<02:01,  3.26it/s]Extracting Features:  18%|█▊        | 85/480 [00:53<02:15,  2.92it/s]Extracting Features:  18%|█▊        | 86/480 [00:53<02:51,  2.30it/s]Extracting Features:  18%|█▊        | 88/480 [00:54<02:15,  2.89it/s]Extracting Features:  19%|█▊        | 89/480 [00:55<02:55,  2.22it/s]Extracting Features:  19%|█▉        | 90/480 [00:56<04:59,  1.30it/s]Extracting Features:  19%|█▉        | 91/480 [00:59<07:51,  1.21s/it]Extracting Features:  19%|█▉        | 92/480 [00:59<05:53,  1.10it/s]Extracting Features:  19%|█▉        | 93/480 [01:03<12:29,  1.94s/it]Extracting Features:  20%|█▉        | 94/480 [01:05<11:34,  1.80s/it]Extracting Features:  20%|██        | 96/480 [01:06<07:24,  1.16s/it]Extracting Features:  20%|██        | 97/480 [01:06<05:56,  1.07it/s]Extracting Features:  20%|██        | 98/480 [01:06<05:19,  1.20it/s]Extracting Features:  21%|██        | 99/480 [01:07<04:39,  1.36it/s]Extracting Features:  21%|██        | 100/480 [01:07<03:40,  1.73it/s]Extracting Features:  21%|██        | 101/480 [01:09<06:40,  1.06s/it]Extracting Features:  22%|██▏       | 104/480 [01:10<03:30,  1.78it/s]Extracting Features:  22%|██▏       | 105/480 [01:10<03:37,  1.73it/s]Extracting Features:  22%|██▏       | 106/480 [01:10<02:58,  2.09it/s]Extracting Features:  22%|██▏       | 107/480 [01:11<02:46,  2.24it/s]Extracting Features:  22%|██▎       | 108/480 [01:11<02:36,  2.38it/s]Extracting Features:  23%|██▎       | 109/480 [01:11<02:14,  2.75it/s]Extracting Features:  23%|██▎       | 110/480 [01:12<02:21,  2.62it/s]Extracting Features:  23%|██▎       | 111/480 [01:12<01:53,  3.26it/s]Extracting Features:  23%|██▎       | 112/480 [01:13<02:24,  2.55it/s]Extracting Features:  24%|██▎       | 113/480 [01:13<02:25,  2.52it/s]Extracting Features:  24%|██▍       | 114/480 [01:13<02:06,  2.88it/s]Extracting Features:  24%|██▍       | 115/480 [01:14<02:24,  2.52it/s]Extracting Features:  24%|██▍       | 116/480 [01:14<01:53,  3.20it/s]Extracting Features:  24%|██▍       | 117/480 [01:14<01:53,  3.21it/s]Extracting Features:  25%|██▍       | 119/480 [01:14<01:13,  4.89it/s]Extracting Features:  25%|██▌       | 120/480 [01:15<02:02,  2.94it/s]Extracting Features:  25%|██▌       | 121/480 [01:15<02:00,  2.99it/s]Extracting Features:  25%|██▌       | 122/480 [01:16<03:04,  1.94it/s]Extracting Features:  26%|██▌       | 123/480 [01:18<04:11,  1.42it/s]Extracting Features:  26%|██▌       | 124/480 [01:18<03:39,  1.62it/s]Extracting Features:  26%|██▌       | 125/480 [01:18<03:01,  1.96it/s]Extracting Features:  26%|██▋       | 127/480 [01:18<01:52,  3.14it/s]Extracting Features:  27%|██▋       | 129/480 [01:19<02:21,  2.48it/s]Extracting Features:  27%|██▋       | 131/480 [01:20<01:42,  3.41it/s]Extracting Features:  28%|██▊       | 133/480 [01:20<01:18,  4.43it/s]Extracting Features:  28%|██▊       | 134/480 [01:20<01:16,  4.53it/s]Extracting Features:  28%|██▊       | 135/480 [01:20<01:30,  3.80it/s]Extracting Features:  28%|██▊       | 136/480 [01:21<01:48,  3.16it/s]Extracting Features:  29%|██▊       | 137/480 [01:21<01:39,  3.44it/s]Extracting Features:  29%|██▉       | 138/480 [01:22<02:08,  2.66it/s]Extracting Features:  29%|██▉       | 139/480 [01:22<01:43,  3.31it/s]Extracting Features:  29%|██▉       | 141/480 [01:24<03:39,  1.55it/s]Extracting Features:  30%|██▉       | 142/480 [01:24<03:00,  1.87it/s]Extracting Features:  30%|██▉       | 143/480 [01:25<02:43,  2.06it/s]Extracting Features:  30%|███       | 144/480 [01:26<03:30,  1.59it/s]Extracting Features:  30%|███       | 145/480 [01:27<03:59,  1.40it/s]Extracting Features:  30%|███       | 146/480 [01:27<04:16,  1.30it/s]Extracting Features:  31%|███       | 147/480 [01:28<03:19,  1.67it/s]Extracting Features:  31%|███       | 148/480 [01:28<02:41,  2.06it/s]Extracting Features:  31%|███       | 149/480 [01:31<06:21,  1.15s/it]Extracting Features:  31%|███▏      | 150/480 [01:32<06:30,  1.18s/it]Extracting Features:  31%|███▏      | 151/480 [01:32<05:36,  1.02s/it]Extracting Features:  32%|███▏      | 152/480 [01:33<04:35,  1.19it/s]Extracting Features:  32%|███▏      | 153/480 [01:33<03:33,  1.53it/s]Extracting Features:  32%|███▏      | 154/480 [01:33<02:50,  1.91it/s]Extracting Features:  32%|███▏      | 155/480 [01:33<02:12,  2.45it/s]Extracting Features:  32%|███▎      | 156/480 [01:34<01:50,  2.94it/s]Extracting Features:  33%|███▎      | 157/480 [01:34<02:09,  2.49it/s]Extracting Features:  33%|███▎      | 158/480 [01:35<03:15,  1.65it/s]Extracting Features:  33%|███▎      | 159/480 [01:36<02:50,  1.89it/s]Extracting Features:  34%|███▍      | 162/480 [01:36<01:26,  3.66it/s]Extracting Features:  34%|███▍      | 163/480 [01:36<01:15,  4.19it/s]Extracting Features:  34%|███▍      | 164/480 [01:37<01:57,  2.69it/s]Extracting Features:  34%|███▍      | 165/480 [01:38<02:36,  2.01it/s]Extracting Features:  35%|███▍      | 166/480 [01:38<02:06,  2.49it/s]Extracting Features:  35%|███▌      | 168/480 [01:38<01:28,  3.54it/s]Extracting Features:  35%|███▌      | 169/480 [01:39<02:06,  2.46it/s]Extracting Features:  36%|███▌      | 172/480 [01:39<01:11,  4.29it/s]Extracting Features:  36%|███▌      | 173/480 [01:41<02:48,  1.82it/s]Extracting Features:  36%|███▋      | 174/480 [01:41<02:36,  1.96it/s]Extracting Features:  36%|███▋      | 175/480 [01:42<02:18,  2.21it/s]Extracting Features:  37%|███▋      | 176/480 [01:42<02:15,  2.24it/s]Extracting Features:  37%|███▋      | 177/480 [01:42<02:08,  2.35it/s]Extracting Features:  37%|███▋      | 179/480 [01:43<02:22,  2.11it/s]Extracting Features:  38%|███▊      | 181/480 [01:45<02:46,  1.79it/s]Extracting Features:  38%|███▊      | 183/480 [01:45<02:02,  2.43it/s]Extracting Features:  38%|███▊      | 184/480 [01:46<02:04,  2.38it/s]Extracting Features:  39%|███▊      | 185/480 [01:46<01:49,  2.68it/s]Extracting Features:  39%|███▉      | 187/480 [01:46<01:42,  2.85it/s]Extracting Features:  39%|███▉      | 189/480 [01:47<01:21,  3.57it/s]Extracting Features:  40%|███▉      | 191/480 [01:48<01:36,  2.99it/s]Extracting Features:  40%|████      | 192/480 [01:49<02:28,  1.95it/s]Extracting Features:  40%|████      | 194/480 [01:50<02:24,  1.99it/s]Extracting Features:  41%|████      | 196/480 [01:51<02:53,  1.64it/s]Extracting Features:  41%|████▏     | 198/480 [01:52<02:03,  2.28it/s]Extracting Features:  41%|████▏     | 199/480 [01:53<03:01,  1.55it/s]Extracting Features:  42%|████▏     | 200/480 [01:53<02:30,  1.86it/s]Extracting Features:  42%|████▏     | 202/480 [01:54<01:53,  2.45it/s]Extracting Features:  42%|████▏     | 203/480 [01:55<02:32,  1.81it/s]Extracting Features:  42%|████▎     | 204/480 [01:55<02:19,  1.98it/s]Extracting Features:  43%|████▎     | 205/480 [01:56<02:39,  1.72it/s]Extracting Features:  43%|████▎     | 206/480 [01:56<02:04,  2.20it/s]Extracting Features:  43%|████▎     | 207/480 [01:57<02:34,  1.76it/s]Extracting Features:  43%|████▎     | 208/480 [01:58<02:48,  1.61it/s]Extracting Features:  44%|████▍     | 210/480 [01:58<01:48,  2.48it/s]Extracting Features:  44%|████▍     | 211/480 [01:58<01:40,  2.67it/s]Extracting Features:  44%|████▍     | 212/480 [01:59<01:39,  2.69it/s]Extracting Features:  44%|████▍     | 213/480 [01:59<01:27,  3.07it/s]Extracting Features:  45%|████▍     | 214/480 [01:59<01:18,  3.38it/s]Extracting Features:  45%|████▍     | 215/480 [01:59<01:28,  2.98it/s]Extracting Features:  45%|████▌     | 216/480 [02:00<01:32,  2.86it/s]Extracting Features:  45%|████▌     | 217/480 [02:00<01:55,  2.28it/s]Extracting Features:  45%|████▌     | 218/480 [02:01<01:39,  2.63it/s]Extracting Features:  46%|████▌     | 220/480 [02:01<01:12,  3.56it/s]Extracting Features:  46%|████▌     | 221/480 [02:01<01:05,  3.92it/s]Extracting Features:  46%|████▋     | 222/480 [02:01<00:59,  4.34it/s]Extracting Features:  46%|████▋     | 223/480 [02:02<01:28,  2.90it/s]Extracting Features:  47%|████▋     | 224/480 [02:02<01:36,  2.66it/s]Extracting Features:  47%|████▋     | 226/480 [02:03<01:12,  3.49it/s]Extracting Features:  48%|████▊     | 228/480 [02:03<00:50,  4.99it/s]Extracting Features:  48%|████▊     | 231/480 [02:04<00:55,  4.47it/s]Extracting Features:  48%|████▊     | 232/480 [02:04<00:50,  4.91it/s]Extracting Features:  49%|████▊     | 233/480 [02:04<00:52,  4.71it/s]Extracting Features:  49%|████▉     | 234/480 [02:04<00:49,  4.96it/s]Extracting Features:  49%|████▉     | 235/480 [02:09<04:59,  1.22s/it]Extracting Features:  49%|████▉     | 237/480 [02:09<03:07,  1.29it/s]Extracting Features:  50%|████▉     | 238/480 [02:09<02:44,  1.47it/s]Extracting Features:  50%|████▉     | 239/480 [02:09<02:18,  1.74it/s]Extracting Features:  50%|█████     | 240/480 [02:10<02:15,  1.77it/s]Extracting Features:  50%|█████     | 241/480 [02:12<03:58,  1.00it/s]Extracting Features:  50%|█████     | 242/480 [02:12<03:02,  1.31it/s]Extracting Features:  51%|█████     | 243/480 [02:12<02:21,  1.67it/s]Extracting Features:  51%|█████     | 244/480 [02:13<01:58,  1.99it/s]Extracting Features:  51%|█████     | 245/480 [02:13<01:32,  2.53it/s]Extracting Features:  51%|█████▏    | 246/480 [02:14<02:29,  1.57it/s]Extracting Features:  51%|█████▏    | 247/480 [02:14<01:52,  2.08it/s]Extracting Features:  52%|█████▏    | 248/480 [02:14<01:27,  2.66it/s]Extracting Features:  52%|█████▏    | 251/480 [02:16<01:35,  2.39it/s]Extracting Features:  53%|█████▎    | 253/480 [02:16<01:16,  2.98it/s]Extracting Features:  53%|█████▎    | 255/480 [02:17<01:16,  2.94it/s]Extracting Features:  53%|█████▎    | 256/480 [02:17<01:13,  3.03it/s]Extracting Features:  54%|█████▎    | 257/480 [02:17<01:04,  3.47it/s]Extracting Features:  54%|█████▍    | 260/480 [02:17<00:40,  5.40it/s]Extracting Features:  54%|█████▍    | 261/480 [02:19<01:40,  2.19it/s]Extracting Features:  55%|█████▍    | 262/480 [02:19<01:23,  2.60it/s]Extracting Features:  55%|█████▌    | 265/480 [02:19<00:51,  4.20it/s]Extracting Features:  55%|█████▌    | 266/480 [02:20<00:52,  4.05it/s]Extracting Features:  56%|█████▌    | 268/480 [02:20<00:39,  5.32it/s]Extracting Features:  56%|█████▌    | 269/480 [02:20<00:36,  5.73it/s]Extracting Features:  56%|█████▋    | 270/480 [02:21<01:11,  2.94it/s]Extracting Features:  56%|█████▋    | 271/480 [02:22<02:10,  1.61it/s]Extracting Features:  57%|█████▋    | 272/480 [02:23<01:45,  1.97it/s]Extracting Features:  57%|█████▋    | 273/480 [02:23<01:27,  2.36it/s]Extracting Features:  57%|█████▋    | 274/480 [02:24<02:20,  1.47it/s]Extracting Features:  57%|█████▋    | 275/480 [02:25<02:05,  1.63it/s]Extracting Features:  57%|█████▊    | 276/480 [02:25<01:46,  1.91it/s]Extracting Features:  58%|█████▊    | 277/480 [02:25<01:36,  2.10it/s]Extracting Features:  58%|█████▊    | 278/480 [02:25<01:15,  2.69it/s]Extracting Features:  58%|█████▊    | 279/480 [02:26<01:18,  2.56it/s]Extracting Features:  58%|█████▊    | 280/480 [02:27<01:44,  1.91it/s]Extracting Features:  59%|█████▊    | 281/480 [02:28<02:11,  1.52it/s]Extracting Features:  59%|█████▉    | 283/480 [02:28<01:25,  2.31it/s]Extracting Features:  59%|█████▉    | 284/480 [02:28<01:14,  2.64it/s]Extracting Features:  59%|█████▉    | 285/480 [02:30<02:18,  1.41it/s]Extracting Features:  60%|█████▉    | 286/480 [02:30<02:12,  1.46it/s]Extracting Features:  60%|██████    | 289/480 [02:31<01:04,  2.94it/s]Extracting Features:  61%|██████    | 291/480 [02:31<00:55,  3.38it/s]Extracting Features:  61%|██████▏   | 294/480 [02:31<00:39,  4.74it/s]Extracting Features:  61%|██████▏   | 295/480 [02:32<00:58,  3.14it/s]Extracting Features:  62%|██████▏   | 296/480 [02:33<01:04,  2.84it/s]Extracting Features:  62%|██████▏   | 297/480 [02:35<02:27,  1.24it/s]Extracting Features:  62%|██████▏   | 298/480 [02:37<02:56,  1.03it/s]Extracting Features:  62%|██████▏   | 299/480 [02:37<02:17,  1.31it/s]Extracting Features:  63%|██████▎   | 301/480 [02:39<02:53,  1.03it/s]Extracting Features:  63%|██████▎   | 302/480 [02:40<02:30,  1.18it/s]Extracting Features:  63%|██████▎   | 303/480 [02:42<03:32,  1.20s/it]Extracting Features:  64%|██████▎   | 305/480 [02:42<02:09,  1.35it/s]Extracting Features:  64%|██████▍   | 306/480 [02:43<01:59,  1.46it/s]Extracting Features:  64%|██████▍   | 307/480 [02:43<01:34,  1.83it/s]Extracting Features:  64%|██████▍   | 309/480 [02:43<01:02,  2.75it/s]Extracting Features:  65%|██████▍   | 310/480 [02:43<00:56,  2.99it/s]Extracting Features:  65%|██████▌   | 312/480 [02:44<01:12,  2.31it/s]Extracting Features:  65%|██████▌   | 314/480 [02:45<01:05,  2.52it/s]Extracting Features:  66%|██████▌   | 316/480 [02:45<00:54,  3.03it/s]Extracting Features:  66%|██████▌   | 317/480 [02:46<00:53,  3.04it/s]Extracting Features:  66%|██████▋   | 318/480 [02:46<01:06,  2.43it/s]Extracting Features:  66%|██████▋   | 319/480 [02:48<01:59,  1.34it/s]Extracting Features:  67%|██████▋   | 320/480 [02:49<01:44,  1.52it/s]Extracting Features:  67%|██████▋   | 321/480 [02:50<02:04,  1.27it/s]Extracting Features:  67%|██████▋   | 322/480 [02:50<01:55,  1.37it/s]Extracting Features:  67%|██████▋   | 323/480 [02:52<02:23,  1.10it/s]Extracting Features:  68%|██████▊   | 324/480 [02:53<02:18,  1.12it/s]Extracting Features:  68%|██████▊   | 325/480 [02:53<02:14,  1.15it/s]Extracting Features:  68%|██████▊   | 327/480 [02:54<01:24,  1.80it/s]Extracting Features:  68%|██████▊   | 328/480 [02:54<01:13,  2.06it/s]Extracting Features:  69%|██████▊   | 329/480 [02:54<01:01,  2.46it/s]Extracting Features:  69%|██████▉   | 330/480 [02:54<00:48,  3.08it/s]Extracting Features:  69%|██████▉   | 331/480 [02:55<00:45,  3.28it/s]Extracting Features:  69%|██████▉   | 333/480 [02:56<01:21,  1.81it/s]Extracting Features:  70%|██████▉   | 334/480 [02:57<01:29,  1.63it/s]Extracting Features:  70%|██████▉   | 335/480 [02:58<01:28,  1.64it/s]Extracting Features:  70%|███████   | 336/480 [02:58<01:35,  1.51it/s]Extracting Features:  70%|███████   | 337/480 [02:59<01:35,  1.50it/s]Extracting Features:  70%|███████   | 338/480 [03:00<01:38,  1.44it/s]Extracting Features:  71%|███████   | 339/480 [03:00<01:17,  1.82it/s]Extracting Features:  71%|███████   | 341/480 [03:01<01:13,  1.88it/s]Extracting Features:  71%|███████▏  | 342/480 [03:01<01:00,  2.29it/s]Extracting Features:  71%|███████▏  | 343/480 [03:01<00:51,  2.68it/s]Extracting Features:  72%|███████▏  | 344/480 [03:02<00:45,  2.99it/s]Extracting Features:  72%|███████▏  | 345/480 [03:02<00:38,  3.51it/s]Extracting Features:  72%|███████▏  | 346/480 [03:02<00:34,  3.93it/s]Extracting Features:  72%|███████▏  | 347/480 [03:02<00:34,  3.85it/s]Extracting Features:  72%|███████▎  | 348/480 [03:03<00:44,  2.97it/s]Extracting Features:  73%|███████▎  | 349/480 [03:03<00:40,  3.23it/s]Extracting Features:  73%|███████▎  | 351/480 [03:03<00:25,  5.00it/s]Extracting Features:  73%|███████▎  | 352/480 [03:03<00:26,  4.88it/s]Extracting Features:  74%|███████▍  | 354/480 [03:04<00:22,  5.50it/s]Extracting Features:  74%|███████▍  | 356/480 [03:04<00:22,  5.56it/s]Extracting Features:  75%|███████▍  | 358/480 [03:04<00:23,  5.29it/s]Extracting Features:  75%|███████▍  | 359/480 [03:05<00:29,  4.06it/s]Extracting Features:  75%|███████▌  | 360/480 [03:05<00:35,  3.43it/s]Extracting Features:  75%|███████▌  | 361/480 [03:06<00:33,  3.57it/s]Extracting Features:  75%|███████▌  | 362/480 [03:07<00:51,  2.30it/s]Extracting Features:  76%|███████▌  | 363/480 [03:08<01:24,  1.39it/s]Extracting Features:  76%|███████▌  | 364/480 [03:09<01:17,  1.50it/s]Extracting Features:  76%|███████▌  | 365/480 [03:10<01:52,  1.02it/s]Extracting Features:  77%|███████▋  | 368/480 [03:11<00:56,  1.97it/s]Extracting Features:  77%|███████▋  | 369/480 [03:12<01:14,  1.48it/s]Extracting Features:  77%|███████▋  | 370/480 [03:13<01:21,  1.35it/s]Extracting Features:  77%|███████▋  | 371/480 [03:17<02:46,  1.53s/it]Extracting Features:  78%|███████▊  | 372/480 [03:18<02:20,  1.30s/it]Extracting Features:  78%|███████▊  | 373/480 [03:18<01:50,  1.03s/it]Extracting Features:  78%|███████▊  | 374/480 [03:18<01:35,  1.12it/s]Extracting Features:  78%|███████▊  | 375/480 [03:20<01:40,  1.04it/s]Extracting Features:  78%|███████▊  | 376/480 [03:21<01:54,  1.10s/it]Extracting Features:  79%|███████▊  | 377/480 [03:22<01:37,  1.05it/s]Extracting Features:  79%|███████▉  | 378/480 [03:22<01:11,  1.43it/s]Extracting Features:  79%|███████▉  | 379/480 [03:22<01:07,  1.50it/s]Extracting Features:  79%|███████▉  | 380/480 [03:23<00:54,  1.83it/s]Extracting Features:  80%|███████▉  | 382/480 [03:23<00:32,  2.98it/s]Extracting Features:  80%|███████▉  | 383/480 [03:23<00:37,  2.55it/s]Extracting Features:  80%|████████  | 384/480 [03:23<00:31,  3.02it/s]Extracting Features:  80%|████████  | 385/480 [03:24<00:27,  3.46it/s]Extracting Features:  80%|████████  | 386/480 [03:24<00:23,  4.04it/s]Extracting Features:  81%|████████  | 387/480 [03:24<00:19,  4.77it/s]Extracting Features:  81%|████████  | 389/480 [03:24<00:16,  5.49it/s]Extracting Features:  81%|████████▏ | 390/480 [03:24<00:18,  4.90it/s]Extracting Features:  81%|████████▏ | 391/480 [03:25<00:17,  5.20it/s]Extracting Features:  82%|████████▏ | 392/480 [03:25<00:15,  5.64it/s]Extracting Features:  82%|████████▏ | 393/480 [03:25<00:19,  4.37it/s]Extracting Features:  82%|████████▏ | 394/480 [03:25<00:21,  3.93it/s]Extracting Features:  82%|████████▎ | 396/480 [03:26<00:15,  5.32it/s]Extracting Features:  83%|████████▎ | 397/480 [03:26<00:14,  5.61it/s]Extracting Features:  83%|████████▎ | 398/480 [03:27<00:34,  2.37it/s]Extracting Features:  83%|████████▎ | 399/480 [03:27<00:30,  2.62it/s]Extracting Features:  83%|████████▎ | 400/480 [03:27<00:27,  2.88it/s]Extracting Features:  84%|████████▎ | 401/480 [03:28<00:30,  2.60it/s]Extracting Features:  84%|████████▍ | 402/480 [03:28<00:29,  2.67it/s]Extracting Features:  84%|████████▍ | 403/480 [03:29<00:33,  2.31it/s]Extracting Features:  84%|████████▍ | 404/480 [03:30<00:48,  1.56it/s]Extracting Features:  84%|████████▍ | 405/480 [03:30<00:44,  1.70it/s]Extracting Features:  85%|████████▍ | 407/480 [03:31<00:26,  2.76it/s]Extracting Features:  85%|████████▌ | 408/480 [03:31<00:21,  3.31it/s]Extracting Features:  85%|████████▌ | 409/480 [03:32<00:30,  2.36it/s]Extracting Features:  85%|████████▌ | 410/480 [03:32<00:23,  2.94it/s]Extracting Features:  86%|████████▌ | 411/480 [03:32<00:19,  3.54it/s]Extracting Features:  86%|████████▌ | 412/480 [03:33<00:34,  2.00it/s]Extracting Features:  86%|████████▌ | 413/480 [03:33<00:29,  2.31it/s]Extracting Features:  86%|████████▋ | 415/480 [03:34<00:32,  1.97it/s]Extracting Features:  87%|████████▋ | 416/480 [03:35<00:30,  2.11it/s]Extracting Features:  87%|████████▋ | 417/480 [03:35<00:28,  2.25it/s]Extracting Features:  87%|████████▋ | 418/480 [03:35<00:22,  2.78it/s]Extracting Features:  87%|████████▋ | 419/480 [03:35<00:18,  3.30it/s]Extracting Features:  88%|████████▊ | 422/480 [03:36<00:11,  5.25it/s]Extracting Features:  88%|████████▊ | 423/480 [03:37<00:19,  2.92it/s]Extracting Features:  88%|████████▊ | 424/480 [03:37<00:16,  3.34it/s]Extracting Features:  89%|████████▊ | 425/480 [03:37<00:20,  2.63it/s]Extracting Features:  89%|████████▉ | 427/480 [03:38<00:14,  3.71it/s]Extracting Features:  89%|████████▉ | 428/480 [03:38<00:16,  3.24it/s]Extracting Features:  89%|████████▉ | 429/480 [03:38<00:16,  3.10it/s]Extracting Features:  90%|████████▉ | 430/480 [03:38<00:13,  3.61it/s]Extracting Features:  90%|████████▉ | 431/480 [03:39<00:11,  4.12it/s]Extracting Features:  90%|█████████ | 432/480 [03:39<00:11,  4.09it/s]Extracting Features:  90%|█████████ | 433/480 [03:39<00:11,  4.06it/s]Extracting Features:  90%|█████████ | 434/480 [03:39<00:10,  4.53it/s]Extracting Features:  91%|█████████ | 436/480 [03:40<00:12,  3.51it/s]Extracting Features:  91%|█████████ | 437/480 [03:40<00:11,  3.66it/s]Extracting Features:  91%|█████████▏| 438/480 [03:41<00:13,  3.18it/s]Extracting Features:  91%|█████████▏| 439/480 [03:42<00:23,  1.76it/s]Extracting Features:  92%|█████████▏| 441/480 [03:43<00:22,  1.73it/s]Extracting Features:  92%|█████████▏| 442/480 [03:43<00:17,  2.13it/s]Extracting Features:  92%|█████████▏| 443/480 [03:44<00:21,  1.70it/s]Extracting Features:  92%|█████████▎| 444/480 [03:44<00:17,  2.08it/s]Extracting Features:  93%|█████████▎| 446/480 [03:45<00:10,  3.13it/s]Extracting Features:  93%|█████████▎| 447/480 [03:45<00:09,  3.53it/s]Extracting Features:  93%|█████████▎| 448/480 [03:45<00:07,  4.16it/s]Extracting Features:  94%|█████████▎| 449/480 [03:46<00:18,  1.71it/s]Extracting Features:  94%|█████████▍| 451/480 [03:47<00:10,  2.66it/s]Extracting Features:  94%|█████████▍| 452/480 [03:47<00:09,  2.98it/s]Extracting Features:  94%|█████████▍| 453/480 [03:47<00:09,  2.81it/s]Extracting Features:  95%|█████████▍| 454/480 [03:47<00:07,  3.29it/s]Extracting Features:  95%|█████████▍| 455/480 [03:48<00:06,  3.79it/s]Extracting Features:  95%|█████████▌| 457/480 [03:48<00:04,  4.67it/s]Extracting Features:  95%|█████████▌| 458/480 [03:49<00:07,  3.04it/s]Extracting Features:  96%|█████████▌| 459/480 [03:49<00:09,  2.20it/s]Extracting Features:  96%|█████████▌| 460/480 [03:50<00:10,  1.91it/s]Extracting Features:  96%|█████████▌| 461/480 [03:52<00:17,  1.06it/s]Extracting Features:  96%|█████████▋| 462/480 [03:52<00:13,  1.33it/s]Extracting Features:  96%|█████████▋| 463/480 [03:53<00:12,  1.32it/s]Extracting Features:  97%|█████████▋| 464/480 [03:54<00:12,  1.26it/s]Extracting Features:  97%|█████████▋| 465/480 [03:55<00:14,  1.05it/s]Extracting Features:  97%|█████████▋| 466/480 [03:56<00:10,  1.32it/s]Extracting Features:  97%|█████████▋| 467/480 [03:57<00:12,  1.02it/s]Extracting Features:  98%|█████████▊| 469/480 [03:59<00:09,  1.17it/s]Extracting Features:  98%|█████████▊| 470/480 [03:59<00:06,  1.46it/s]Extracting Features:  98%|█████████▊| 471/480 [03:59<00:05,  1.63it/s]Extracting Features:  98%|█████████▊| 472/480 [03:59<00:04,  1.85it/s]Extracting Features:  99%|█████████▊| 473/480 [04:03<00:10,  1.45s/it]Extracting Features:  99%|█████████▉| 474/480 [04:05<00:08,  1.48s/it]Extracting Features:  99%|█████████▉| 475/480 [04:08<00:09,  1.84s/it]Extracting Features:  99%|█████████▉| 476/480 [04:08<00:05,  1.40s/it]Extracting Features:  99%|█████████▉| 477/480 [04:15<00:09,  3.10s/it]Extracting Features: 100%|█████████▉| 478/480 [04:17<00:05,  2.76s/it]Extracting Features: 100%|█████████▉| 479/480 [04:23<00:03,  3.72s/it]Extracting Features: 100%|██████████| 480/480 [04:23<00:00,  2.72s/it]Extracting Features: 100%|██████████| 480/480 [04:23<00:00,  1.82it/s]
2026-01-03 22:19:23,791 - INFO - [full] Saved 8 errors.
2026-01-03 22:19:23,808 - INFO - [full] Saved 472 features.
2026-01-03 22:19:23,831 - INFO - [windowed] Saved 8 errors.
2026-01-03 22:19:23,867 - INFO - [windowed] Saved 472 features.
2026-01-03 22:19:23,867 - INFO - Processing complete.
--- Step 03: Preoperative prep & split ---
/media/volume/catch22/projects/aki_prediction_project/data_preparation/step_03_preop_prep.py:341: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '[36.19350394 35.36194927 19.55436873 34.65144411]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  df_processed.loc[low_outlier_indices, col] = low_replacements
--- Step 03: Preoperative Data Preparation ---
Input: /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_pleth_ecg_co2_awp.csv
Output: /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_preop_processed.csv
Loaded cohort data. Shape: (120, 84)
Merging preop labs from lab_data.csv. Shape: (99, 4)
Performing stratified train/test split (80/20)...
Train set: 96, Test set: 24
Processing categorical variables...
Merging 2 departments into 'other'
Applying one-hot encoding...
Handling outliers...
Leaving missing values as NaN (no imputation)
Saving processed data to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_preop_processed.csv...
Done.
--- Step 04: Intraoperative prep ---
--- Step 04: Intraoperative Data Preparation ---

--- Processing Full Features Waveform Data ---
Input: /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_pleth_ecg_co2_awp_inf.csv
Loaded data. Shape: (472, 27)
Pivoting to wide format...
Pivot complete. Shape before flattening: (119, 96)
Flattening column names...
Column names flattened. Shape: (119, 98)
Saving to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_intraop_wide.csv...
Done with Full Features.

--- Processing Windowed Features Waveform Data ---
Input: /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_pleth_ecg_co2_awp_inf_windowed.csv
Loaded data. Shape: (472, 99)
Pivoting to wide format...
Pivot complete. Shape before flattening: (119, 384)
Flattening column names...
Column names flattened. Shape: (119, 386)
Saving to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_intraop_wide_windowed.csv...
Done with Windowed Features.
--- Step 05: Data merge ---
--- Step 05: Data Merge ---
Loading Preop Data from /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_preop_processed.csv...
Preop Data Shape: (120, 55)

--- Merging Full Features Data ---
Intraop Input: /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_intraop_wide.csv
Loaded intraop data. Shape: (119, 98)
Merging with preoperative data...
WARNING: Merge introduced 984 NaN values.
Leaving NaNs in merged output (imputation disabled).
Final merged shape: (119, 151)
Saving to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_features_master_wide.csv...
Done with Full Features.

--- Merging Windowed Features Data ---
Intraop Input: /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_intraop_wide_windowed.csv
Loaded intraop data. Shape: (119, 386)
Merging with preoperative data...
WARNING: Merge introduced 1272 NaN values.
Leaving NaNs in merged output (imputation disabled).
Final merged shape: (119, 439)
Saving to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_features_master_wide_windowed.csv...
Done with Windowed Features.
--- Step 06: Hyperparameter search (XGBoost smoke) ---
2026-01-03 22:19:27,632 - INFO - Starting HPO for Outcome: any_aki, Branch: windowed, Feature Set: all_waveforms, Model: xgboost
2026-01-03 22:19:27,632 - INFO - SMOKE TEST MODE: Running with reduced trials.
2026-01-03 22:19:27,632 - INFO - Loading data from /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_features_master_wide_windowed.csv...
2026-01-03 22:19:27,649 - INFO - Data loaded. Shape: (119, 439)
2026-01-03 22:19:27,652 - INFO - Using existing 'split_group' column for train/test split.
2026-01-03 22:19:27,653 - INFO - Data prepared. Train shape: (95, 384), Test shape: (24, 384)
2026-01-03 22:19:27,654 - INFO - Positive samples in train: 47, Negative: 48, Scale Pos Weight: 1.0213
  0%|          | 0/2 [00:00<?, ?it/s]Best trial: 0. Best value: 0.719466:   0%|          | 0/2 [00:03<?, ?it/s]Best trial: 0. Best value: 0.719466:  50%|█████     | 1/2 [00:03<00:03,  3.22s/it]Best trial: 0. Best value: 0.719466:  50%|█████     | 1/2 [00:06<00:03,  3.22s/it]Best trial: 0. Best value: 0.719466: 100%|██████████| 2/2 [00:06<00:00,  3.26s/it]Best trial: 0. Best value: 0.719466: 100%|██████████| 2/2 [00:06<00:00,  3.25s/it]
2026-01-03 22:19:34,165 - INFO - HPO Complete. Best AUPRC: 0.7195
2026-01-03 22:19:34,165 - INFO - Best Params: {'n_estimators': 200, 'learning_rate': 0.02766064317571892, 'max_depth': 10, 'subsample': 0.9672498850560157, 'colsample_bytree': 0.7247780197078506, 'gamma': 1.792818251141834, 'reg_lambda': 2.0950575433890043e-07, 'reg_alpha': 0.00971324513737461}
2026-01-03 22:19:34,166 - INFO - Best parameters saved to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/params/xgboost/any_aki/windowed/all_waveforms.json
--- Step 07: Train & evaluate (XGBoost smoke) ---
2026-01-03 22:19:36,345 - INFO - Starting Training/Evaluation for Outcome: any_aki, Branch: windowed, Feature Set: all_waveforms, Model: xgboost
2026-01-03 22:19:36,345 - INFO - Loading data from /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_features_master_wide_windowed.csv...
2026-01-03 22:19:36,363 - INFO - Data loaded. Shape: (119, 439)
2026-01-03 22:19:36,367 - INFO - Using existing 'split_group' column for train/test split.
2026-01-03 22:19:36,369 - INFO - Data prepared. Train shape: (95, 384), Test shape: (24, 384)
2026-01-03 22:19:36,369 - INFO - Positive samples in train: 47, Negative: 48, Scale Pos Weight: 1.0213
2026-01-03 22:19:36,369 - INFO - SMOKE TEST: Reducing data size.
2026-01-03 22:19:36,369 - INFO - Generating out-of-fold predictions for calibration...
2026-01-03 22:19:37,050 - INFO - Training final model on full training data...
2026-01-03 22:19:37,204 - INFO - Generating predictions on test set...
2026-01-03 22:19:37,270 - INFO - Saved train OOF predictions to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/xgboost/any_aki/windowed/all_waveforms/predictions/train_oof.csv
2026-01-03 22:19:37,270 - INFO - Saved test predictions to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/xgboost/any_aki/windowed/all_waveforms/predictions/test.csv
2026-01-03 22:19:37,270 - INFO - Saved calibration and threshold artifacts to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/xgboost/any_aki/windowed/all_waveforms/artifacts
2026-01-03 22:19:37,271 - INFO - Saved model to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/xgboost/any_aki/windowed/all_waveforms/model.json
2026-01-03 22:19:37,271 - INFO - Training and evaluation complete.
--- Step 06: Hyperparameter search (EBM smoke) ---
2026-01-03 22:19:38,857 - INFO - Starting HPO for Outcome: any_aki, Branch: windowed, Feature Set: all_waveforms, Model: ebm
2026-01-03 22:19:38,858 - INFO - SMOKE TEST MODE: Running with reduced trials.
2026-01-03 22:19:38,858 - INFO - Loading data from /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_features_master_wide_windowed.csv...
2026-01-03 22:19:38,875 - INFO - Data loaded. Shape: (119, 439)
2026-01-03 22:19:38,878 - INFO - Using existing 'split_group' column for train/test split.
2026-01-03 22:19:38,880 - INFO - Data prepared. Train shape: (95, 384), Test shape: (24, 384)
2026-01-03 22:19:38,880 - INFO - Positive samples in train: 47, Negative: 48, Scale Pos Weight: 1.0213
2026-01-03 22:19:38,880 - INFO - Pre-computing quantile cuts to freeze bins for EBM HPO...
2026-01-03 22:19:38,955 - INFO - Bins computed. Starting HPO with frozen feature_types.
  0%|          | 0/2 [00:00<?, ?it/s]2026-01-03 22:19:39,062 - INFO - EBM lib loading.
2026-01-03 22:19:39,062 - INFO - Finding library for Linux, x86_64, bitsize=64, debug=False
2026-01-03 22:19:39,062 - INFO - Loading EBM library /home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/utils/../root/bld/lib/libebm_linux_x64.so
2026-01-03 22:19:39,281 - INFO - Creating native dataset
2026-01-03 22:20:40,972 - INFO - Start boosting
2026-01-03 22:20:40,972 - INFO - Booster allocation start
2026-01-03 22:20:40,972 - INFO - Booster allocation end
2026-01-03 22:20:40,974 - INFO - Deallocation boosting start
2026-01-03 22:20:40,974 - INFO - Deallocation boosting end
/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/glassbox/_ebm/_ebm.py:871: UserWarning: Missing values detected. Our visualizations do not currently display missing values. To retain the glassbox nature of the model you need to either set the missing values to an extreme value like -1000 that will be visible on the graphs, or manually examine the missing value score in ebm.term_scores_[term_index][0]
  warn(
2026-01-03 22:20:41,153 - INFO - Creating native dataset
2026-01-03 22:21:41,706 - INFO - Start boosting
2026-01-03 22:21:41,706 - INFO - Booster allocation start
2026-01-03 22:21:41,707 - INFO - Booster allocation end
2026-01-03 22:21:41,708 - INFO - Deallocation boosting start
2026-01-03 22:21:41,708 - INFO - Deallocation boosting end
/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/glassbox/_ebm/_ebm.py:871: UserWarning: Missing values detected. Our visualizations do not currently display missing values. To retain the glassbox nature of the model you need to either set the missing values to an extreme value like -1000 that will be visible on the graphs, or manually examine the missing value score in ebm.term_scores_[term_index][0]
  warn(
2026-01-03 22:21:41,874 - INFO - Creating native dataset
2026-01-03 22:22:42,340 - INFO - Start boosting
2026-01-03 22:22:42,340 - INFO - Booster allocation start
2026-01-03 22:22:42,340 - INFO - Booster allocation end
2026-01-03 22:22:42,342 - INFO - Deallocation boosting start
2026-01-03 22:22:42,342 - INFO - Deallocation boosting end
/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/glassbox/_ebm/_ebm.py:871: UserWarning: Missing values detected. Our visualizations do not currently display missing values. To retain the glassbox nature of the model you need to either set the missing values to an extreme value like -1000 that will be visible on the graphs, or manually examine the missing value score in ebm.term_scores_[term_index][0]
  warn(
2026-01-03 22:22:42,508 - INFO - Creating native dataset
2026-01-03 22:23:49,999 - INFO - Start boosting
2026-01-03 22:23:49,999 - INFO - Booster allocation start
2026-01-03 22:23:50,000 - INFO - Booster allocation end
2026-01-03 22:23:50,001 - INFO - Deallocation boosting start
2026-01-03 22:23:50,001 - INFO - Deallocation boosting end
/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/glassbox/_ebm/_ebm.py:871: UserWarning: Missing values detected. Our visualizations do not currently display missing values. To retain the glassbox nature of the model you need to either set the missing values to an extreme value like -1000 that will be visible on the graphs, or manually examine the missing value score in ebm.term_scores_[term_index][0]
  warn(
2026-01-03 22:23:50,165 - INFO - Creating native dataset
2026-01-03 22:24:50,398 - INFO - Start boosting
2026-01-03 22:24:50,399 - INFO - Booster allocation start
2026-01-03 22:24:50,399 - INFO - Booster allocation end
2026-01-03 22:24:50,401 - INFO - Deallocation boosting start
2026-01-03 22:24:50,401 - INFO - Deallocation boosting end
Best trial: 0. Best value: 0.664228:   0%|          | 0/2 [05:11<?, ?it/s]Best trial: 0. Best value: 0.664228:  50%|█████     | 1/2 [05:11<05:11, 311.46s/it]2026-01-03 22:24:50,576 - INFO - Creating native dataset
2026-01-03 22:27:47,743 - INFO - Start boosting
2026-01-03 22:27:47,744 - INFO - Booster allocation start
2026-01-03 22:27:47,744 - INFO - Booster allocation end
2026-01-03 22:27:47,746 - INFO - Deallocation boosting start
2026-01-03 22:27:47,746 - INFO - Deallocation boosting end
/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/glassbox/_ebm/_ebm.py:871: UserWarning: Missing values detected. Our visualizations do not currently display missing values. To retain the glassbox nature of the model you need to either set the missing values to an extreme value like -1000 that will be visible on the graphs, or manually examine the missing value score in ebm.term_scores_[term_index][0]
  warn(
2026-01-03 22:27:47,912 - INFO - Creating native dataset
2026-01-03 22:30:45,021 - INFO - Start boosting
2026-01-03 22:30:45,021 - INFO - Booster allocation start
2026-01-03 22:30:45,022 - INFO - Booster allocation end
2026-01-03 22:30:45,024 - INFO - Deallocation boosting start
2026-01-03 22:30:45,024 - INFO - Deallocation boosting end
/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/glassbox/_ebm/_ebm.py:871: UserWarning: Missing values detected. Our visualizations do not currently display missing values. To retain the glassbox nature of the model you need to either set the missing values to an extreme value like -1000 that will be visible on the graphs, or manually examine the missing value score in ebm.term_scores_[term_index][0]
  warn(
2026-01-03 22:30:45,197 - INFO - Creating native dataset
2026-01-03 22:33:43,286 - INFO - Start boosting
2026-01-03 22:33:43,286 - INFO - Booster allocation start
2026-01-03 22:33:43,286 - INFO - Booster allocation end
2026-01-03 22:33:43,288 - INFO - Deallocation boosting start
2026-01-03 22:33:43,288 - INFO - Deallocation boosting end
/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/glassbox/_ebm/_ebm.py:871: UserWarning: Missing values detected. Our visualizations do not currently display missing values. To retain the glassbox nature of the model you need to either set the missing values to an extreme value like -1000 that will be visible on the graphs, or manually examine the missing value score in ebm.term_scores_[term_index][0]
  warn(
2026-01-03 22:33:43,470 - INFO - Creating native dataset
2026-01-03 22:36:41,487 - INFO - Start boosting
2026-01-03 22:36:41,487 - INFO - Booster allocation start
2026-01-03 22:36:41,488 - INFO - Booster allocation end
2026-01-03 22:36:41,489 - INFO - Deallocation boosting start
2026-01-03 22:36:41,489 - INFO - Deallocation boosting end
/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/glassbox/_ebm/_ebm.py:871: UserWarning: Missing values detected. Our visualizations do not currently display missing values. To retain the glassbox nature of the model you need to either set the missing values to an extreme value like -1000 that will be visible on the graphs, or manually examine the missing value score in ebm.term_scores_[term_index][0]
  warn(
2026-01-03 22:36:41,670 - INFO - Creating native dataset
2026-01-03 22:39:47,233 - INFO - Start boosting
2026-01-03 22:39:47,233 - INFO - Booster allocation start
2026-01-03 22:39:47,234 - INFO - Booster allocation end
2026-01-03 22:39:47,235 - INFO - Deallocation boosting start
2026-01-03 22:39:47,236 - INFO - Deallocation boosting end
Best trial: 0. Best value: 0.664228:  50%|█████     | 1/2 [20:08<05:11, 311.46s/it]Best trial: 0. Best value: 0.664228: 100%|██████████| 2/2 [20:08<00:00, 655.80s/it]Best trial: 0. Best value: 0.664228: 100%|██████████| 2/2 [20:08<00:00, 604.15s/it]
2026-01-03 22:39:47,255 - INFO - HPO Complete. Best AUPRC: 0.6642
2026-01-03 22:39:47,255 - INFO - Best Params: {'max_leaves': 3, 'smoothing_rounds': 750, 'learning_rate': 0.04, 'validation_size': 0.3, 'early_stopping_rounds': 100, 'early_stopping_tolerance': 1e-05, 'min_samples_leaf': 10, 'min_hessian': 0.0, 'greedy_ratio': 2.0, 'cyclic_progress': 1.0}
2026-01-03 22:39:47,256 - INFO - Best parameters saved to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/params/ebm/any_aki/windowed/all_waveforms.json
--- Step 07: Train & evaluate (EBM smoke) ---
2026-01-03 22:39:49,607 - INFO - Starting Training/Evaluation for Outcome: any_aki, Branch: windowed, Feature Set: all_waveforms, Model: ebm
2026-01-03 22:39:49,607 - INFO - Loading data from /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/data/processed/aki_features_master_wide_windowed.csv...
2026-01-03 22:39:49,625 - INFO - Data loaded. Shape: (119, 439)
2026-01-03 22:39:49,629 - INFO - Using existing 'split_group' column for train/test split.
2026-01-03 22:39:49,630 - INFO - Data prepared. Train shape: (95, 384), Test shape: (24, 384)
2026-01-03 22:39:49,630 - INFO - Positive samples in train: 47, Negative: 48, Scale Pos Weight: 1.0213
2026-01-03 22:39:49,630 - INFO - SMOKE TEST: Reducing data size.
2026-01-03 22:39:49,660 - INFO - EBM: Dataset size 95 >= 50; using configured n_jobs=-2
2026-01-03 22:39:49,660 - INFO - Generating out-of-fold predictions for calibration...
2026-01-03 22:39:49,661 - INFO - EBM lib loading.
2026-01-03 22:39:49,661 - INFO - Finding library for Linux, x86_64, bitsize=64, debug=False
2026-01-03 22:39:49,662 - INFO - Loading EBM library /home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/utils/../root/bld/lib/libebm_linux_x64.so
2026-01-03 22:39:49,875 - INFO - Creating native dataset
2026-01-03 22:40:13,039 - INFO - Start boosting
2026-01-03 22:40:13,039 - INFO - Booster allocation start
2026-01-03 22:40:13,039 - INFO - Booster allocation end
2026-01-03 22:40:13,041 - INFO - Deallocation boosting start
2026-01-03 22:40:13,041 - INFO - Deallocation boosting end
/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/glassbox/_ebm/_ebm.py:871: UserWarning: Missing values detected. Our visualizations do not currently display missing values. To retain the glassbox nature of the model you need to either set the missing values to an extreme value like -1000 that will be visible on the graphs, or manually examine the missing value score in ebm.term_scores_[term_index][0]
  warn(
2026-01-03 22:40:13,271 - INFO - Creating native dataset
2026-01-03 22:40:35,681 - INFO - Start boosting
2026-01-03 22:40:35,681 - INFO - Booster allocation start
2026-01-03 22:40:35,681 - INFO - Booster allocation end
2026-01-03 22:40:35,683 - INFO - Deallocation boosting start
2026-01-03 22:40:35,683 - INFO - Deallocation boosting end
2026-01-03 22:40:35,908 - INFO - Creating native dataset
2026-01-03 22:40:58,151 - INFO - Start boosting
2026-01-03 22:40:58,151 - INFO - Booster allocation start
2026-01-03 22:40:58,151 - INFO - Booster allocation end
2026-01-03 22:40:58,153 - INFO - Deallocation boosting start
2026-01-03 22:40:58,153 - INFO - Deallocation boosting end
2026-01-03 22:40:58,373 - INFO - Creating native dataset
2026-01-03 22:41:23,018 - INFO - Start boosting
2026-01-03 22:41:23,019 - INFO - Booster allocation start
2026-01-03 22:41:23,019 - INFO - Booster allocation end
2026-01-03 22:41:23,021 - INFO - Deallocation boosting start
2026-01-03 22:41:23,021 - INFO - Deallocation boosting end
2026-01-03 22:41:23,251 - INFO - Creating native dataset
2026-01-03 22:41:44,993 - INFO - Start boosting
2026-01-03 22:41:44,993 - INFO - Booster allocation start
2026-01-03 22:41:44,993 - INFO - Booster allocation end
2026-01-03 22:41:44,995 - INFO - Deallocation boosting start
2026-01-03 22:41:44,995 - INFO - Deallocation boosting end
2026-01-03 22:41:45,054 - INFO - Training final model on full training data...
/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/site-packages/interpret/glassbox/_ebm/_ebm.py:871: UserWarning: Missing values detected. Our visualizations do not currently display missing values. To retain the glassbox nature of the model you need to either set the missing values to an extreme value like -1000 that will be visible on the graphs, or manually examine the missing value score in ebm.term_scores_[term_index][0]
  warn(
2026-01-03 22:41:45,317 - INFO - Creating native dataset
2026-01-03 22:42:09,659 - INFO - Start boosting
2026-01-03 22:42:09,659 - INFO - Booster allocation start
2026-01-03 22:42:09,660 - INFO - Booster allocation end
2026-01-03 22:42:09,661 - INFO - Deallocation boosting start
2026-01-03 22:42:09,662 - INFO - Deallocation boosting end
2026-01-03 22:42:09,669 - INFO - Generating predictions on test set...
2026-01-03 22:42:09,704 - INFO - Saved train OOF predictions to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/ebm/any_aki/windowed/all_waveforms/predictions/train_oof.csv
2026-01-03 22:42:09,704 - INFO - Saved test predictions to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/ebm/any_aki/windowed/all_waveforms/predictions/test.csv
2026-01-03 22:42:09,705 - INFO - Saved calibration and threshold artifacts to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/ebm/any_aki/windowed/all_waveforms/artifacts
2026-01-03 22:42:09,722 - INFO - Saved model to /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/ebm/any_aki/windowed/all_waveforms/model.pkl
2026-01-03 22:42:09,722 - INFO - Skipping SHAP generation for model type ebm
2026-01-03 22:42:09,722 - INFO - Skipping EBM explanation export (disabled or smoke test)
2026-01-03 22:42:09,722 - INFO - Training and evaluation complete.
--- Reporting: metrics summary ---
2026-01-03 22:42:11,464 - INFO - Found 2 prediction files for pattern /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/**/predictions/test.csv
2026-01-03 22:42:11,464 - INFO - Loading predictions from /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/xgboost/any_aki/windowed/all_waveforms/predictions/test.csv
2026-01-03 22:42:11,470 - INFO - Loading predictions from /home/exouser/js2-volume/projects/aki_prediction_project/smoke_test_outputs/results/models/ebm/any_aki/windowed/all_waveforms/predictions/test.csv
Traceback (most recent call last):
  File "/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/home/exouser/.conda/envs/aki_prediction_project/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/media/volume/catch22/projects/aki_prediction_project/results_recreation/metrics_summary.py", line 339, in <module>
    main()
  File "/media/volume/catch22/projects/aki_prediction_project/results_recreation/metrics_summary.py", line 334, in main
    summary_df, bootstrap_df = summarize(prediction_sets, n_bootstrap=args.bootstrap)
  File "/media/volume/catch22/projects/aki_prediction_project/results_recreation/metrics_summary.py", line 235, in summarize
    metrics = compute_point_metrics(pred_set)
  File "/media/volume/catch22/projects/aki_prediction_project/results_recreation/metrics_summary.py", line 169, in compute_point_metrics
    "precision": _safe_metric(precision_score, y_true, y_pred, zero_division=0),
TypeError: _safe_metric() got an unexpected keyword argument 'zero_division'
